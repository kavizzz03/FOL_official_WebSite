<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FOL Clothing | Home</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"/>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- AOS for animations -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- Swiper -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="Styles/index.css">
  <style>

  </style>
</head>
<body>

  <!-- Header -->
  <div id="header"></div>

  <!-- Hero Slider -->
  <div class="swiper hero-swiper">
    <div class="swiper-wrapper" id="slideshow-container"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-pagination"></div>
  </div>

  <!-- Top Sellers Section -->
  <section class="container mt-5">
    <h3 class="text-center mb-4 fw-bold" data-aos="fade-up">ðŸ”¥ Top Sellers</h3>
    <div class="product-slider" id="top-sellers"></div>
  </section>

  <!-- Latest Arrivals Section -->
  <section class="container mt-5">
    <h3 class="text-center mb-4 fw-bold" data-aos="fade-up">âœ¨ Latest Arrivals</h3>
    <div class="product-slider" id="latest-arrivals"></div>
  </section>

  <!-- Product Modal -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="modalTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body d-flex flex-column flex-md-row gap-4">
          <img id="modalImage" src="" class="img-fluid rounded-3" alt="Product">
          <div>
            <p id="modalPrice" class="fs-5 fw-bold text-success"></p>
            <p id="modalColors" class="mb-2"></p>
            <p id="modalSizes" class="mb-3"></p>
            <div class="mb-2">
              <label for="colorSelect" class="form-label">Select Color:</label>
              <select id="colorSelect" class="form-select"></select>
            </div>
            <div class="mb-2">
              <label for="sizeSelect" class="form-label">Select Size:</label>
              <select id="sizeSelect" class="form-select"></select>
            </div>
            <button id="addToCartBtn" class="btn btn-success mt-3 w-100">Add to Cart</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Subscribe Section -->
  <section class="container subscribe-card mt-5">
    <h4 class="text-center mb-4 fw-bold">Subscribe for Exclusive Updates ðŸ’Œ</h4>
    <form id="subscribeForm">
      <div class="mb-3">
        <input type="email" class="form-control form-control-lg" id="email" placeholder="Enter your email" required>
      </div>
      <div class="d-grid mb-3">
        <button type="button" class="btn btn-success btn-lg" onclick="sendCode()">Send Code</button>
      </div>
      <div id="verifySection" style="display:none;">
        <div class="mb-3">
          <input type="text" class="form-control form-control-lg" id="code" placeholder="Enter verification code">
        </div>
        <div class="d-grid mb-3">
          <button type="button" class="btn btn-primary btn-lg" onclick="verifyCode()">Verify</button>
        </div>
      </div>
    </form>
  </section>

  <!-- Footer -->
  <div id="footer"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <script>
    AOS.init({ duration:1000, once:true, easing:'ease-in-out' });

    // Load header & footer
    fetch("header.html").then(res=>res.text()).then(data=>{document.getElementById("header").innerHTML=data});
    fetch("footer.html").then(res=>res.text()).then(data=>{document.getElementById("footer").innerHTML=data});

    // Hero Swiper
    fetch('get_slideshow.php').then(res=>res.json()).then(data=>{
      const container=document.getElementById("slideshow-container");
      container.innerHTML=data.map(item=>`
        <div class="swiper-slide" style="position:relative;">
          <img src="${item.image_url}" alt="${item.description}">
          <div class="slide-caption">
            <h2 data-aos="fade-down">${item.title || ''}</h2>
            <p data-aos="fade-up" data-aos-delay="200">${item.description}</p>
            <a href="${item.product_link}" class="btn btn-success btn-lg mt-3" data-aos="zoom-in" data-aos-delay="400">Shop Now</a>
          </div>
        </div>
      `).join('');

      const swiper=new Swiper('.hero-swiper',{
        loop:true, speed:1200,
        autoplay:{ delay:5000, disableOnInteraction:false },
        effect:'fade', fadeEffect:{ crossFade:true },
        navigation:{ nextEl:'.swiper-button-next', prevEl:'.swiper-button-prev' },
        pagination:{ el:'.swiper-pagination', clickable:true }
      });
      AOS.refresh();
    }).catch(err=>console.error(err));

    // Product sliders
    function populateProducts(url, containerId){
      fetch(url).then(res=>res.json()).then(data=>{
        if(!data.success) return console.error("Error fetching products");
        const container=document.getElementById(containerId);
        container.innerHTML='';
        data.products.forEach(item=>{
          const card=document.createElement('div');
          card.className='product-card';
          card.setAttribute('data-bs-toggle','modal');
          card.setAttribute('data-bs-target','#productModal');

          card.addEventListener('click', ()=>{
            document.getElementById('modalImage').src=item.image_url;
            document.getElementById('modalTitle').innerText=item.name;
            document.getElementById('modalPrice').innerText=`Rs ${item.price}`;
            document.getElementById('modalColors').innerText=`Colors: ${item.colors.join(', ')}`;
            document.getElementById('modalSizes').innerText=`Sizes: ${item.sizes.join(', ')}`;

            const colorSelect=document.getElementById('colorSelect');
            colorSelect.innerHTML='';
            item.colors.forEach(c=>{ const opt=document.createElement('option'); opt.value=c; opt.innerText=c; colorSelect.appendChild(opt); });

            const sizeSelect=document.getElementById('sizeSelect');
            sizeSelect.innerHTML='';
            item.sizes.forEach(s=>{ const opt=document.createElement('option'); opt.value=s; opt.innerText=s; sizeSelect.appendChild(opt); });
          });

          card.innerHTML=`
            <img src="${item.image_url}" alt="${item.name}">
            <p class="fw-bold">${item.name}</p>
            <p class="text-success fw-semibold">Rs ${item.price}</p>`;
          container.appendChild(card);
        });
      }).catch(err=>console.error(err));
    }
    populateProducts('get_top_sellers.php','top-sellers');
    populateProducts('get_latest_arrivals.php','latest-arrivals');

    // Cart logic
    function updateCartCount(){
      const cart=JSON.parse(localStorage.getItem('cart'))||[];
      const countEl=document.getElementById('cart-count');
      if(countEl) countEl.innerText=cart.length;
    }
    document.addEventListener('click', e=>{
      if(e.target.id==='addToCartBtn'){
        const product={
          name:document.getElementById('modalTitle').innerText,
          price:parseFloat(document.getElementById('modalPrice').innerText.replace('Rs ','').trim()),
          color:document.getElementById('colorSelect').value,
          size:document.getElementById('sizeSelect').value,
          image:document.getElementById('modalImage').src
        };
        let cart=JSON.parse(localStorage.getItem('cart'))||[];
        cart.push(product);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();

        Swal.fire({
          icon:'success', title:'Added to Cart!', text:`${product.name} added.`, toast:true, position:'top-end', timer:2000, showConfirmButton:false
        });

        const productModal=bootstrap.Modal.getInstance(document.getElementById('productModal'));
        if(productModal) productModal.hide();
      }
    });
    updateCartCount();

    // Subscribe logic
    let generatedCode='';
    function sendCode(){
      const email=document.getElementById('email').value;
      if(!email) return;
      generatedCode=Math.floor(100000 + Math.random()*900000);
      fetch('send_verification_code.php',{
        method:'POST',
        body:JSON.stringify({email,code:generatedCode}),
        headers:{'Content-Type':'application/json'}
      }).then(res=>res.json()).then(resp=>{
        if(resp.success){
          document.getElementById('verifySection').style.display='block';
          Swal.fire({icon:'success', title:'Code Sent!', text:'Verification code sent to your email.', timer:2000, showConfirmButton:false});
        } else Swal.fire({icon:'error', title:'Oops!', text:'Failed to send verification code.'});
      });
    }
    function verifyCode(){
      const codeInput=document.getElementById('code').value;
      if(codeInput==generatedCode){
        const email=document.getElementById('email').value;
        fetch('add_email_to_database.php',{
          method:'POST',
          body:JSON.stringify({email}),
          headers:{'Content-Type':'application/json'}
        }).then(res=>res.json()).then(resp=>{
          if(resp.success){
            Swal.fire({icon:'success', title:'Verified!', text:'Email verified & saved successfully.'});
            document.getElementById('email').value='';
            document.getElementById('code').value='';
            document.getElementById('verifySection').style.display='none';
          } else Swal.fire({icon:'error', title:'Error!', text:'Failed to save email.'});
        });
      } else Swal.fire({icon:'error', title:'Invalid Code', text:'The code you entered is incorrect.'});
    }
  </script>

</body>
</html>
