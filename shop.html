<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FOL Clothing | Shop</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"/>

  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }
    h2 {
      color: #212529;
    }
    /* =============================
       Product Cards
    ============================= */
    .product-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: 0.35s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .product-card img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .product-card:hover img {
      transform: scale(1.05);
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0,0,0,0.15);
    }

    .product-card p {
      padding: 10px 15px;
    }

    .product-card .fw-bold {
      font-size: 1.05rem;
      color: #222;
    }

    .product-card .text-success {
      font-size: 0.95rem;
      font-weight: 600;
    }

    /* =============================
       Modal (Product Details)
    ============================= */
    .modal-content {
      border-radius: 16px;
      border: none;
    }

    .modal-header {
      border-bottom: none;
    }

    #modalImage {
      max-width: 320px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    #addToCartBtn {
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 12px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div id="header"></div>

  <div class="container py-4">
    <h2 class="text-center mb-4 fw-bold">üõç Shop Our Collection</h2>

    <!-- Search Bar -->
    <div class="search-bar input-group mb-4">
      <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
    </div>

    <!-- Category Buttons -->
    <div class="d-flex justify-content-center gap-2 mb-4">
      <button class="btn btn-outline-dark" onclick="loadProducts('All')">All</button>
      <button class="btn btn-outline-dark" onclick="loadProducts('Mens')">Mens</button>
      <button class="btn btn-outline-dark" onclick="loadProducts('Womens')">Womens</button>
      <button class="btn btn-outline-dark" onclick="loadProducts('Kids')">Kids</button>
    </div>

    <!-- Products Grid -->
    <div class="row g-3" id="productList"></div>
  </div>

  <!-- Product Modal -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="modalTitle"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body d-flex flex-column flex-md-row gap-4">
          <img id="modalImage" src="" class="img-fluid rounded-3" alt="Product">
          <div>
            <p id="modalPrice" class="fs-5 fw-bold text-success"></p>
            <p id="modalColors" class="mb-2"></p>
            <p id="modalSizes" class="mb-3"></p>
            <div class="mb-2">
              <label for="colorSelect" class="form-label">Select Color:</label>
              <select id="colorSelect" class="form-select"></select>
            </div>
            <div class="mb-2">
              <label for="sizeSelect" class="form-label">Select Size:</label>
              <select id="sizeSelect" class="form-select"></select>
            </div>
            <button id="addToCartBtn" class="btn btn-success mt-3 w-100">Add to Cart</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    AOS.init({ duration:1000, once:true, easing:'ease-in-out' });

    // Load header & footer
    fetch("header.html").then(res=>res.text()).then(data=>{document.getElementById("header").innerHTML=data});
    fetch("footer.html").then(res=>res.text()).then(data=>{document.getElementById("footer").innerHTML=data});

    // ========================
    // Load Products
    // ========================
    function loadProducts(category = 'All') {
      const searchText = document.getElementById('searchInput').value.trim();

      fetch(`get_products.php?category=${category}&search=${encodeURIComponent(searchText)}`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('productList');
          container.innerHTML = '';

          if (!data.success || data.products.length === 0) {
            container.innerHTML = '<p class="text-center mt-4">No products found.</p>';
            return;
          }

          data.products.forEach(item => {
            const col = document.createElement('div');
            col.className = 'col-6 col-sm-4 col-md-3';
            col.innerHTML = `
              <div class="product-card">
                <img src="${item.image_url}" alt="${item.name}">
                <p class="fw-bold mt-2">${item.name}</p>
                <p class="text-success fw-semibold">Rs ${item.price}</p>
              </div>`;

            col.querySelector('.product-card').addEventListener('click', () => openProduct(item));
            container.appendChild(col);
          });
        })
        .catch(err => console.error("Error:", err));
    }

    // ========================
    // Open Product Modal
    // ========================
    function openProduct(item) {
      document.getElementById('modalImage').src = item.image_url;
      document.getElementById('modalTitle').innerText = item.name;
      document.getElementById('modalPrice').innerText = `Rs ${item.price}`;
      document.getElementById('modalColors').innerText = `Colors: ${item.colors.join(', ')}`;
      document.getElementById('modalSizes').innerText = `Sizes: ${item.sizes.join(', ')}`;

      const colorSelect = document.getElementById('colorSelect');
      colorSelect.innerHTML = '';
      item.colors.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.innerText = c;
        colorSelect.appendChild(opt);
      });

      const sizeSelect = document.getElementById('sizeSelect');
      sizeSelect.innerHTML = '';
      item.sizes.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        opt.innerText = s;
        sizeSelect.appendChild(opt);
      });

      document.getElementById('addToCartBtn').onclick = () => {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.push({
          id: item.id,
          name: item.name,
          price: item.price,
          color: colorSelect.value,
          size: sizeSelect.value,
          image: item.image_url
        });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        Swal.fire({
          icon: 'success',
          title: 'Added to Cart',
          text: `${item.name} added!`,
          timer: 1500,
          showConfirmButton: false
        });
        bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
      };

      new bootstrap.Modal(document.getElementById('productModal')).show();
    }

    // ========================
    // Cart Count
    // ========================
    function updateCartCount(){
      const cart=JSON.parse(localStorage.getItem('cart'))||[];
      const countEl=document.getElementById('cart-count');
      if(countEl) countEl.innerText=cart.length;
    }

    // ========================
    // Dynamic Search (Debounced)
    // ========================
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        loadProducts();
      }, 400); // wait 400ms after typing
    });

    // Initial load
    document.addEventListener("DOMContentLoaded", () => {
      loadProducts();
      updateCartCount();
    });
  </script>
</body>
</html>
